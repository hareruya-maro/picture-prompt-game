# 実装計画

## 概要

`doc/blueprint.md` に基づくフロントエンドおよびバックエンドの実装計画。
各タスクのステータスは以下のいずれかで示される。

- **未着手:** まだ作業を開始していないタスク
- **着手:** 作業中のタスク
- **完了:** 実装が完了したタスク

---

## 1. プロジェクト基盤

- **ステータス:** 完了
- **タスク:**
    - [x] Firebaseプロジェクトのセットアップ (Authentication, Firestore, Storage)
    - [x] Next.jsプロジェクトの環境変数設定 (`.env.local`)
    - [x] Firebase SDK の導入と設定

## 2. 認証

- **ステータス:** 完了
- **タスク:**
  - [x] Firebase Authentication を利用した匿名認証の実装

## 3. ルーム作成・参加フロー

- **ステータス:** 完了
- **担当:**
- **ページ:**
  - [x] トップページ (`/`) - **完了 (既存)**
  - [x] ルーム作成ページ (`/create-room`) - **完了 (既存)**
  - [x] ルーム参加ページ (`/access-room`) - **完了 (既存)**
- **機能:**
  - [x] **ルーム作成:**
      - [x] ホストがゲーム設定（投票モード、ラウンド数）を入力
      - [x] Firestore にルーム情報を新規作成（ルーム ID、設定、ホスト情報など）
      - [x] 作成後、待機画面 (`/waiting-room`) に遷移
  - [x] **ルーム参加:**
      - [x] プレイヤーがルーム ID と名前を入力
      - [x] Firestore から対象のルームを検索
      - [x] ルーム情報に参加者を追加
      - [x] 参加後、待機画面 (`/waiting-room`) に遷移

## 4. ゲームフロー

### 4.1. 待機画面 (`/waiting-room`)

- **ステータス:** 完了
- **ページ:**
    - [x] 待機画面 (`/waiting-room/[roomId]`) - **完了**
- **機能:**
    - [x] Firestore から現在の参加者一覧をリアルタイムで取得・表示
    - [x] ホストにのみ「ゲーム開始」ボタンを表示
    - [x] ゲーム開始時、Firestore のゲーム状態を「お題発表」に更新し、全プレイヤーをプロンプト入力画面に遷移させる

### 4.2. お題発表 & プロンプト入力 (`/input-prompt`)

- **ステータス:** 完了
- **ページ:**
  - [x] プロンプト入力画面 (`/input-prompt`) - **完了**
- **バックエンド (Genkit/Firebase Functions):**
    - [x] ゲーム開始時にキーワードを元にお題プロンプトを自動生成
    - [x] 生成したプロンプトで Vertex AI (Imagen) を呼び出し、「お手本の絵」を生成
    - [x] 生成した絵を Cloud Storage for Firebase に保存
- **フロントエンド機能:**
  - [x] Storage から「お手本の絵」をダウンロードして表示
  - [x] プロンプト入力用のテキストエリアを設置
  - [x] 入力されたプロンプトを Firestore に保存
  - [ ] (オプション) Vertex AI (STT) を利用した音声入力機能の実装

### 4.3. お絵かき & 投票 (`/vote`)

- **ステータス:** 完了
- **ページ:**
  - [x] 投票画面 (`/vote`) - **完了**
- **バックエンド (Genkit/Firebase Functions):**
  - [x] 全プレイヤーのプロンプトが揃ったら、各プロンプトで Vertex AI (Imagen) を呼び出し、絵を生成
  - [x] 生成した全ての絵を Storage に保存
- **フロントエンド機能:**
  - [x] 全員の絵が生成されるまでの待機表示
  - [x] 生成された絵を一覧で表示（記名/匿名モード対応）
  - [x] 絵の拡大表示機能
  - [x] 投票機能（1 人 1 票、自分にも投票可）
  - [x] 投票データを Firestore に保存

### 4.4. 結果発表 (`/result`)

- **ステータス:** 完了
- **ページ:**
  - [x] 結果発表画面 (`/result`) - **完了**
- **機能:**
  - [x] 投票結果（誰が何票獲得したか）を表示
  - [x] 各絵の作者と、生成に使われたプロンプトを公開
  - [x] ラウンドごとの得点を計算し、ランキング形式で表示
  - [x] 「次のラウンドへ」ボタンを設置（最終ラウンドでない場合）
  - [x] 最終ラウンドの場合、「最終結果へ」ボタンを設置

### 4.5. 最終結果 (`/final-result`)

- **ステータス:** 完了
- **ページ:**
  - [x] 最終結果画面 (`/final-result`) - **完了**
- **機能:**
  - [x] 総合得点ランキングの表示
  - [x] 「トップに戻る」ボタンを設置

## 5. その他

- **ステータス:** 未着手
- **タスク:**
  - [ ] UI/UX の改善（ポップなデザイン、分かりやすい操作性）
  - [ ] 全体的なエラーハンドリング（Firestore, Storage, API 呼び出し等）
  - [ ] レスポンシブデザイン対応